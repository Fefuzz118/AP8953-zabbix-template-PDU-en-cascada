zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 7df96b18c230490a9a0a9e2307226338
      name: 'Templates/Power'
  templates:
    - uuid: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
      template: 'APC PDU 8953 Cascaded'
      name: 'APC PDU 8953 Cascaded (rPDU2)'
      description: |
        Template para monitoreo de regletas APC 8953 en cascada.
        Soporta hasta 4 PDUs en cascada bajo la misma IP.
        
        Estructura de índices:
        - Índices 1,2 = PDU 1
        - Índices 3,4 = PDU 2
        - Índices 5,6 = PDU 3
        - Índices 7,8 = PDU 4
        
        OIDs basados en PowerNet-MIB v4.x (rPDU2)
        
        Autor: Template generado para Zabbix 7.4.6
        Fecha: 2026-02-03
      groups:
        - name: 'Templates/Power'
      items:
        # ===========================
        # INFORMACIÓN DEL DISPOSITIVO
        # ===========================
        - uuid: b1234567890abcdef1234567890abcd1
          name: 'Device Model'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.318.1.1.26.2.1.6.1
          key: apc.pdu.device.model
          delay: 1h
          history: 7d
          trends: 0
          value_type: CHAR
          description: 'Modelo del dispositivo PDU'
          tags:
            - tag: Application
              value: General
        
        - uuid: b1234567890abcdef1234567890abcd2
          name: 'Device Name'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.318.1.1.26.2.1.8.1
          key: apc.pdu.device.name
          delay: 1h
          history: 7d
          trends: 0
          value_type: CHAR
          description: 'Nombre del dispositivo PDU'
          tags:
            - tag: Application
              value: General
        
        - uuid: b1234567890abcdef1234567890abcd3
          name: 'Device Location'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.318.1.1.26.2.1.9.1
          key: apc.pdu.device.location
          delay: 1h
          history: 7d
          trends: 0
          value_type: CHAR
          description: 'Ubicación del dispositivo PDU'
          tags:
            - tag: Application
              value: General
        
        - uuid: b1234567890abcdef1234567890abcd4
          name: 'Firmware Version'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.318.1.1.4.2.3
          key: apc.pdu.firmware.version
          delay: 1h
          history: 7d
          trends: 0
          value_type: CHAR
          description: 'Versión del firmware'
          tags:
            - tag: Application
              value: General
        
        - uuid: b1234567890abcdef1234567890abcd5
          name: 'Device Serial Number'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.318.1.1.26.4.1.1.3.1
          key: apc.pdu.device.serial
          delay: 1h
          history: 7d
          trends: 0
          value_type: CHAR
          description: 'Número de serie del dispositivo'
          tags:
            - tag: Application
              value: General

      discovery_rules:
        # ===========================
        # DISCOVERY: PDU DEVICES
        # ===========================
        - uuid: d1234567890abcdef1234567890abcd1
          name: 'PDU Device Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.318.1.1.26.4.3.1.5]'
          key: pdu.device.discovery
          delay: 1h
          description: |
            Descubre todas las PDUs en cascada.
            Usa rPDU2DeviceStatusPower para detectar PDUs activas.
          item_prototypes:
            # Potencia consumida
            - uuid: i1234567890abcdef1234567890abcd1
              name: 'PDU {#SNMPINDEX}: Power Consumption'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.4.3.1.5.{#SNMPINDEX}'
              key: 'apc.pdu[{#SNMPINDEX},power]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              units: 'kW'
              description: 'Consumo de energía en centésimas de kilovatios (dividir por 100)'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.01'
              tags:
                - tag: Application
                  value: 'PDU {#SNMPINDEX}'
                - tag: PDU
                  value: '{#SNMPINDEX}'
            
            # Estado de carga
            - uuid: i1234567890abcdef1234567890abcd2
              name: 'PDU {#SNMPINDEX}: Load State'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.4.3.1.4.{#SNMPINDEX}'
              key: 'apc.pdu[{#SNMPINDEX},load.state]'
              delay: 1m
              history: 7d
              value_type: UNSIGNED
              description: |
                Estado de carga de la PDU:
                1 = lowLoad
                2 = normal
                3 = nearOverload
                4 = overload
              valuemap:
                name: 'APC PDU Load State'
              tags:
                - tag: Application
                  value: 'PDU {#SNMPINDEX}'
                - tag: PDU
                  value: '{#SNMPINDEX}'
            
            # Corriente de entrada
            - uuid: i1234567890abcdef1234567890abcd3
              name: 'PDU {#SNMPINDEX}: Input Current'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.4.3.1.9.{#SNMPINDEX}'
              key: 'apc.pdu[{#SNMPINDEX},input.current]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              units: A
              description: 'Corriente de entrada en décimas de amperios'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                - tag: Application
                  value: 'PDU {#SNMPINDEX}'
                - tag: PDU
                  value: '{#SNMPINDEX}'
            
            # Energía acumulada
            - uuid: i1234567890abcdef1234567890abcd4
              name: 'PDU {#SNMPINDEX}: Energy Accumulated'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.4.3.1.12.{#SNMPINDEX}'
              key: 'apc.pdu[{#SNMPINDEX},energy.accumulated]'
              delay: 5m
              history: 7d
              value_type: FLOAT
              units: 'kWh'
              description: 'Energía acumulada en décimas de kilovatios-hora'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                - tag: Application
                  value: 'PDU {#SNMPINDEX}'
                - tag: PDU
                  value: '{#SNMPINDEX}'
            
            # Potencia aparente
            - uuid: i1234567890abcdef1234567890abcd5
              name: 'PDU {#SNMPINDEX}: Apparent Power'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.4.3.1.16.{#SNMPINDEX}'
              key: 'apc.pdu[{#SNMPINDEX},apparent.power]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              units: VA
              description: 'Potencia aparente en voltio-amperios'
              tags:
                - tag: Application
                  value: 'PDU {#SNMPINDEX}'
                - tag: PDU
                  value: '{#SNMPINDEX}'
            
            # Factor de potencia
            - uuid: i1234567890abcdef1234567890abcd6
              name: 'PDU {#SNMPINDEX}: Power Factor'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.4.3.1.17.{#SNMPINDEX}'
              key: 'apc.pdu[{#SNMPINDEX},power.factor]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              description: 'Factor de potencia en centésimas (dividir por 100)'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.01'
              tags:
                - tag: Application
                  value: 'PDU {#SNMPINDEX}'
                - tag: PDU
                  value: '{#SNMPINDEX}'

        # ===========================
        # DISCOVERY: BANK/PHASE STATUS (2 por PDU)
        # ===========================
        - uuid: d1234567890abcdef1234567890abcd2
          name: 'PDU Bank/Phase Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.318.1.1.26.8.3.1.5]'
          key: pdu.bank.discovery
          delay: 1h
          description: |
            Descubre banks/phases de las PDUs.
            Típicamente 2 por PDU física (índices pares).
            
            Mapeo:
            - Índices 1,2 → PDU 1
            - Índices 3,4 → PDU 2
            - Índices 5,6 → PDU 3
            - Índices 7,8 → PDU 4
          item_prototypes:
            # Corriente del bank
            - uuid: i1234567890abcdef1234567890abcd7
              name: 'Bank {#SNMPINDEX}: Current'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.8.3.1.5.{#SNMPINDEX}'
              key: 'apc.pdu.bank[{#SNMPINDEX},current]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              units: A
              description: 'Corriente del bank en décimas de amperios'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                - tag: Application
                  value: 'Bank {#SNMPINDEX}'
                - tag: Bank
                  value: '{#SNMPINDEX}'
            
            # Estado de carga del bank
            - uuid: i1234567890abcdef1234567890abcd8
              name: 'Bank {#SNMPINDEX}: Load State'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.8.3.1.4.{#SNMPINDEX}'
              key: 'apc.pdu.bank[{#SNMPINDEX},load.state]'
              delay: 1m
              history: 7d
              value_type: UNSIGNED
              description: |
                Estado de carga del bank:
                1 = lowLoad
                2 = normal
                3 = nearOverload
                4 = overload
              valuemap:
                name: 'APC PDU Load State'
              tags:
                - tag: Application
                  value: 'Bank {#SNMPINDEX}'
                - tag: Bank
                  value: '{#SNMPINDEX}'
            
            # Voltaje del bank
            - uuid: i1234567890abcdef1234567890abcd9
              name: 'Bank {#SNMPINDEX}: Voltage'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.8.3.1.6.{#SNMPINDEX}'
              key: 'apc.pdu.bank[{#SNMPINDEX},voltage]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              units: V
              description: 'Voltaje del bank en voltios'
              tags:
                - tag: Application
                  value: 'Bank {#SNMPINDEX}'
                - tag: Bank
                  value: '{#SNMPINDEX}'

        # ===========================
        # DISCOVERY: PHASE STATUS
        # ===========================
        - uuid: d1234567890abcdef1234567890abcd3
          name: 'PDU Phase Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.318.1.1.26.6.3.1.5]'
          key: pdu.phase.discovery
          delay: 1h
          description: |
            Descubre las fases de entrada de las PDUs.
          item_prototypes:
            # Corriente de fase
            - uuid: i1234567890abcdef1234567890abcda
              name: 'Phase {#SNMPINDEX}: Current'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.6.3.1.5.{#SNMPINDEX}'
              key: 'apc.pdu.phase[{#SNMPINDEX},current]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              units: A
              description: 'Corriente de la fase en décimas de amperios'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                - tag: Application
                  value: 'Phase {#SNMPINDEX}'
                - tag: Phase
                  value: '{#SNMPINDEX}'
            
            # Voltaje de fase
            - uuid: i1234567890abcdef1234567890abcdb
              name: 'Phase {#SNMPINDEX}: Voltage'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.6.3.1.6.{#SNMPINDEX}'
              key: 'apc.pdu.phase[{#SNMPINDEX},voltage]'
              delay: 1m
              history: 7d
              value_type: FLOAT
              units: V
              description: 'Voltaje de la fase en voltios'
              tags:
                - tag: Application
                  value: 'Phase {#SNMPINDEX}'
                - tag: Phase
                  value: '{#SNMPINDEX}'

        # ===========================
        # DISCOVERY: OUTLETS (Tomas individuales)
        # ===========================
        - uuid: d1234567890abcdef1234567890abcd4
          name: 'PDU Outlet Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.318.1.1.26.9.2.3.1.5]'
          key: pdu.outlet.discovery
          delay: 1h
          description: |
            Descubre las tomas individuales (outlets) de todas las PDUs.
            Hasta 24 outlets detectados.
          item_prototypes:
            # Corriente del outlet
            - uuid: i1234567890abcdef1234567890abcdc
              name: 'Outlet {#SNMPINDEX}: Current'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.9.2.3.1.5.{#SNMPINDEX}'
              key: 'apc.pdu.outlet[{#SNMPINDEX},current]'
              delay: 2m
              history: 7d
              value_type: FLOAT
              units: A
              description: 'Corriente del outlet en décimas de amperios'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                - tag: Application
                  value: 'Outlet {#SNMPINDEX}'
                - tag: Outlet
                  value: '{#SNMPINDEX}'

        # ===========================
        # DISCOVERY: TEMPERATURE/HUMIDITY SENSORS
        # ===========================
        - uuid: d1234567890abcdef1234567890abcd5
          name: 'Temperature/Humidity Sensor Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.318.1.1.26.10.2.2.1.8]'
          key: pdu.sensor.discovery
          delay: 1h
          description: |
            Descubre sensores de temperatura/humedad conectados a las PDUs.
          item_prototypes:
            # Temperatura
            - uuid: i1234567890abcdef1234567890abcdd
              name: 'Sensor {#SNMPINDEX}: Temperature'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.10.2.2.1.8.{#SNMPINDEX}'
              key: 'apc.pdu.sensor[{#SNMPINDEX},temperature]'
              delay: 2m
              history: 7d
              value_type: FLOAT
              units: '°C'
              description: 'Temperatura del sensor en décimas de grados Celsius'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                - tag: Application
                  value: 'Sensor {#SNMPINDEX}'
                - tag: Sensor
                  value: '{#SNMPINDEX}'
            
            # Humedad
            - uuid: i1234567890abcdef1234567890abcde
              name: 'Sensor {#SNMPINDEX}: Humidity'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.26.10.2.2.1.10.{#SNMPINDEX}'
              key: 'apc.pdu.sensor[{#SNMPINDEX},humidity]'
              delay: 2m
              history: 7d
              value_type: UNSIGNED
              units: '%'
              description: 'Humedad relativa del sensor en porcentaje'
              tags:
                - tag: Application
                  value: 'Sensor {#SNMPINDEX}'
                - tag: Sensor
                  value: '{#SNMPINDEX}'

        # ===========================
        # DISCOVERY: LEGACY PHASE (si aplica)
        # ===========================
        - uuid: d1234567890abcdef1234567890abcd6
          name: 'Legacy Phase Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.318.1.1.12.2.3.1.1.3]'
          key: pdu.legacy.phase.discovery
          delay: 1h
          description: |
            Descubre fases usando OIDs legacy (compatibilidad con modelos antiguos).
          item_prototypes:
            # Corriente legacy
            - uuid: i1234567890abcdef1234567890abcdf
              name: 'Legacy Phase {#SNMPINDEX}: Current'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.318.1.1.12.2.3.1.1.3.{#SNMPINDEX}'
              key: 'apc.pdu.legacy.phase[{#SNMPINDEX},current]'
              delay: 2m
              history: 7d
              value_type: FLOAT
              units: A
              description: 'Corriente de fase (OID legacy) en décimas de amperios'
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                - tag: Application
                  value: 'Legacy Phase {#SNMPINDEX}'
                - tag: Legacy
                  value: '{#SNMPINDEX}'

      valuemaps:
        - uuid: v1234567890abcdef1234567890abcd1
          name: 'APC PDU Load State'
          mappings:
            - value: '1'
              newvalue: 'Low Load'
            - value: '2'
              newvalue: 'Normal'
            - value: '3'
              newvalue: 'Near Overload'
            - value: '4'
              newvalue: 'Overload'

  graphs:
    - uuid: g1234567890abcdef1234567890abcd1
      name: 'PDU Power Overview'
      graph_items:
        - color: 1A7C11
          item:
            host: 'APC PDU 8953 Cascaded'
            key: 'apc.pdu[1,power]'
        - sortorder: '1'
          color: F63100
          item:
            host: 'APC PDU 8953 Cascaded'
            key: 'apc.pdu[2,power]'
        - sortorder: '2'
          color: 2774A4
          item:
            host: 'APC PDU 8953 Cascaded'
            key: 'apc.pdu[3,power]'
        - sortorder: '3'
          color: A54F10
          item:
            host: 'APC PDU 8953 Cascaded'
            key: 'apc.pdu[4,power]'
